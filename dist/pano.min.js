(function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("pano",[],e):"object"==typeof exports?exports.pano=e():t.pano=e()})(this,function(){return function(t){function e(i){if(o[i])return o[i].exports;var a=o[i]={i:i,l:!1,exports:{}};return t[i].call(a.exports,a,a.exports,e),a.l=!0,a.exports}var o={};return e.m=t,e.c=o,e.d=function(t,o,i){e.o(t,o)||Object.defineProperty(t,o,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var o=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(o,"a",o),o},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=12)}([function(t,e,o){var i=o(4),a=window.pano.domain,n=i.getUrlParameter("hid")?a+i.getUrlParameter("hid")+"/":a,r="true"===i.getUrlParameter("fsnewtab"),s={housePathPrefix:n,isSingleMode:!!i.getUrlParameter("mode"),largeViewBgColor:6710886,switchAutoTimeout:6e3,isPhone:i.checkIsPhone(),displayRoomName:!0,isPlayCameraFlyAnimation:!1,isDisplayPanoramaFirst:!0,enableBlurLoading:!1,isFullScreenInNewTab:r,alwaysDisplayThumbnail:!1};t.exports=s},function(t,e){var o={screenWidth:window.innerWidth,screenHeight:window.innerHeight};o.Publisher=function(){this.messageTypes={}},o.Publisher.prototype.subscribe=function(t,e,o){var i=this.messageTypes[t];if(i){if(-1!==this.findSubscriber(i,e))return}else i=[],this.messageTypes[t]=i;i.push({subscriber:e,callback:o})},o.Publisher.prototype.unsubscribe=function(t,e,o){if(e){var i=this.messageTypes[t];if(i){var a=this.findSubscriber(i,e,o);-1!==a&&this.messageTypes[t].splice(a,1)}}else delete this.messageTypes[t]},o.Publisher.prototype.publish=function(t){var e=this.messageTypes[t];if(e)for(var o=0;o<e.length;o++){for(var i=[],a=0;a<arguments.length-1;a++)i.push(arguments[a+1]);e[o].callback.apply(e[o].subscriber,i)}},o.Publisher.prototype.findSubscriber=function(t,e){for(var o=0;o<t.length;o++)if(t[o]===e)return o;return-1},o.App=function(){o.Publisher.call(this),this.renderer=null,this.scene=null,this.objects=[],this.isWindowResized=!1},o.App.prototype=new o.Publisher,o.App.prototype.init=function(t){t=t||{},this.container=t.container,this.renderer=t.renderer,this.container.appendChild(this.renderer.domElement),this.scene=t.scene,this.scene.data=this;var e=new THREE.Object3D;e.name="root",this.scene.add(e),this.root=e},o.App.prototype.run=function(){this.update();var t=this;requestAnimationFrame(function(){t.run()})},o.App.prototype.update=function(){o.screenWidth===window.innerWidth&&o.screenHeight===window.innerHeight||(o.screenWidth=window.innerWidth,o.screenHeight=window.innerHeight,this.isWindowResized=!0,this.onWindowResize());var t,e;for(e=this.objects.length,t=0;t<e;t++)this.isWindowResized&&this.objects[t].onWindowResize(),this.objects[t].object3D.visible&&i(this.objects[t].object3D)&&this.objects[t].update(),this.objects[t].updateChildren();this.isWindowResized=!1};var i=function t(e){var o=!0;return e.parent&&(o=!!e.parent.visible&&t(e.parent)),o};o.App.prototype.addObject=function(t){this.objects.push(t),t.object3D&&this.root.add(t.object3D)},o.App.prototype.removeObject=function(t){var e=this.objects.indexOf(t);-1!==e&&(this.objects.splice(e,1),t.object3D&&this.root.remove(t.object3D))},o.App.prototype.onWindowResize=function(){},o.Object=function(){o.Publisher.call(this),this.object3D=null,this.children=[]},o.Object.prototype=new o.Publisher,o.Object.prototype.init=function(){},o.Object.prototype.onWindowResize=function(){},o.Object.prototype.update=function(){},o.Object.prototype.setVisible=function(t){this.setVisibleIncludeChildren(this.object3D,t)},o.Object.prototype.setVisibleIncludeChildren=function(t,e){function o(t,e){t.visible=e;var i,a=t.children.length;for(i=0;i<a;i++)o(t.children[i],e)}t&&o(t,e)},o.Object.prototype.setLayer=function(t){function e(t,o){t.layers.set(o);var i,a=t.children.length;for(i=0;i<a;i++)e(t.children[i],o)}this.object3D&&e(this.object3D,t)},o.Object.prototype.updateChildren=function(){var t,e;for(e=this.children.length,t=0;t<e;t++)this.isWindowResized&&this.children[t].onWindowResize(),this.children[t].object3D.visible&&i(this.children[t].object3D)&&this.children[t].update(),this.children[t].updateChildren()},o.Object.prototype.setObject3D=function(t){t.data=this,this.object3D=t},o.Object.prototype.addChild=function(t){this.children.push(t),t.object3D&&this.object3D.add(t.object3D)},o.Object.prototype.removeChild=function(t){var e=this.children.indexOf(t);-1!==e&&(this.children.splice(e,1),t.object3D&&this.object3D.remove(t.object3D))},o.Object.prototype.getScene=function(){var t=null;if(this.object3D){for(var e=this.object3D;e.parent;)e=e.parent;t=e}return t},o.Object.prototype.getApp=function(){var t=this.getScene();return t?t.data:null},o.Object.prototype.getRenderer=function(){var t=this.getApp();return t?t.renderer:null},t.exports=o},function(t,e,o){var i=o(0),a=o(4),n=function(){};n.maxRunningNum=5,n.taskQueue=[],n.runningTasks=[],n.preparedResources=[],n.textureLoader=void 0,n.retryNum=3,n.getTextureLoader=function(){return n.textureLoader||(n.textureLoader=new THREE.TextureLoader),n.textureLoader},n.Task=function(t,e,o,i){this.url=t,this.onLoad=e,this.onProgress=o,this.onError=i;var a=this;this.run=function(){n.loadTexture(this.url,function(t){for(var e in n.runningTasks)if(n.runningTasks[e]===a){n.runningTasks.splice(e,1);break}n.runTasks(),a.onLoad&&a.onLoad(t)},this.onProgress,this.onError)}},n.runTasks=function(){var t=n.maxRunningNum-n.runningTasks.length;if(0!==t&&0!==n.taskQueue.length){t=Math.min(t,n.taskQueue.length);for(var e=0;e<t;e++){var o=n.taskQueue.shift();n.runningTasks.push(o),o.run()}}},n.loadTexture=function(t,e,o,i){function a(l){if(s<n.retryNum){var c=n.getTextureLoader().load(t,e,o,a);r.image=c.image,r.needsUpdate=!0,s++}else i&&i(l)}var r=n.preparedResources[t],s=0;return r?(delete n.preparedResources[t],e&&e(r)):(t=t.replace("\\","/"),r=n.getTextureLoader().load(t,e,o,a)),r},n.loadTextureInQueue=function(t,e,o,i){var a=new n.Task(t,e,o,i);n.taskQueue.push(a),n.runTasks()},n.loadTextures=function(t,e,o,i,a){for(var r=[],s=0,l=function(a,n){r[a]=n,++s,e&&e(t[a],n),i&&i(parseInt(100*s/t.length)),s===t.length&&o&&o(r)},c=0;c<t.length;++c)r[c]=function(e){return n.loadTexture(t[e],function(t){l(e,t)},null,a)}(c);return r},n.cancelTextures=function(t){for(var e in t)n.cancelTexture(t[e])},n.cancelTexture=function(t){t.image.src="",t.dispose()},n.prepareResources=function(t,e,o,i){n.loadTextures(t,function(t,e){n.preparedResources[t]=e},e,o,i)},n.getHouseViewData=function(t){var e=i.housePathPrefix+"ViewData.txt",o=i.housePathPrefix+"SingleViewData.txt",r=i.isSingleMode?o:e;$.ajax({url:r,type:"get",dataType:"text",success:function(e){try{var o=JSON.parse(e);o.ID=a.getUrlParameter("hid"),t(o)}catch(e){t(null,-1)}},error:function(e){i.isSingleMode||404!==e.status?t(null,e.status):(i.isSingleMode=!0,n.getHouseViewData(t))}})},t.exports=n},function(t,e){var o={switchAutoButton:document.getElementById("switchAutoButton"),switch2DButton:document.getElementById("switch2DButton"),switch3DButton:document.getElementById("switch3DButton"),zoomInButton:document.getElementById("zoomInButton"),zoomOutButton:document.getElementById("zoomOutButton"),fullScreenButton:document.getElementById("fullScreenButton"),switchVRButton:document.getElementById("switchVRButton"),vrStartTip:document.getElementById("vrStartTip"),welcome:document.getElementById("welcome"),loading:document.getElementById("loading"),loadingTip:document.getElementById("loading_tip"),loadingProgressBar:document.getElementById("loading_progress_bar"),loading_bar:document.getElementById("loading_bar"),vrHouseContainer:document.getElementById("vr_house_container"),controlDiv:document.getElementById("controlDiv"),controlTip:document.getElementById("controlTip"),rotationTip:document.getElementById("rotationTip"),enterHotSpotTip:document.getElementById("enterHotSpotTip"),controllerLeft:document.getElementById("controller-left"),naviLeft:document.getElementById("naviLeft"),naviRight:document.getElementById("naviRight"),thumbnails:document.getElementById("thumbnails"),thumbnailList:document.getElementById("thumbnail-list"),thumbnailController:document.getElementById("thumbnail-controller"),thumbnailControlButton:document.getElementById("thumbnail-control-button"),enterPanoramaViewBtn:document.getElementById("enterPanoramaViewBtn"),largeViewSwitchController:document.getElementById("largeViewSwitchController"),largeViewSwitch2DButton:document.getElementById("largeViewSwitch2DButton"),largeViewSwitch3DButton:document.getElementById("largeViewSwitch3DButton")};t.exports=o},function(t,e){var o=function(){};o.checkIsPhone=function(){var t=navigator.userAgent.toLowerCase(),e="ipad"==t.match(/ipad/i),o="iphone os"==t.match(/iphone os/i),i="midp"==t.match(/midp/i),a="rv:1.2.3.4"==t.match(/rv:1.2.3.4/i),n="ucweb"==t.match(/ucweb/i),r="android"==t.match(/android/i),s="windows ce"==t.match(/windows ce/i),l="windows mobile"==t.match(/windows mobile/i);return e||o||i||a||n||r||s||l},o.getUrlParameter=function(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),o=window.location.search.substr(1).match(e);return o?decodeURIComponent(o[2]):null},o.setFullScreen=function(t){t?document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen?document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):document.body.msRequestFullscreen&&document.body.msRequestFullscreen():document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()},o.isLandscape=function(){var t;return 180===window.orientation||0===window.orientation?t=!1:90!==window.orientation&&-90!==window.orientation||(t=!0),t},o.addStats=function(t){function e(){o.update(),requestAnimationFrame(e)}var o=new Stats;t.appendChild(o.dom),e()},o.worldToScreenPoint=function(t,e,o){var i=new THREE.Vector3,a=.5*e.context.canvas.width,n=.5*e.context.canvas.height;return t.updateMatrixWorld(),i.setFromMatrixPosition(t.matrixWorld),i.project(o),i.x=i.x*a+a,i.y=-i.y*n+n,new THREE.Vector2(i.x,i.y)},o.contains=function(t,e){var o=!1;for(var i in t)t[i]===e&&(o=!0);return o},t.exports=o},function(t,e,o){var i=o(1),a=function t(e){var o=!0;return e.parent&&(o=!!e.parent.visible&&t(e.parent)),o},n=function(){this.onclick=function(t){},this.object3D=null,this.camera=null,this.pressDownTime=null,this.enabled=!0,this.findCamera=function(){if(!this.camera){for(var t=this.object3D;t.parent;)t=t.parent;this.camera=r.findCamera(t,this.object3D.layers.mask)}return this.camera},this.process=function(t,e,o){if("touchstart"===t.type||"mousedown"===t.type)this.isIntersect(t,e,o)&&(this.pressDownTime=(new Date).getTime());else if(("touchend"===t.type||"mouseup"===t.type)&&this.isIntersect(t,e,o)){var i=(new Date).getTime();this.pressDownTime&&i-this.pressDownTime<200&&this.onclick(this.object3D)}},this.getFirstIntersect=function(t,e,o,i){var a=this.getIntersects(t,e,o,i);return a.length>0?a[0]:null},this.getIntersects=function(t,e,o,i){var a=i?new THREE.Vector2:this.getMousePosition(t,o);if(a.x<-1||a.x>1||a.y<-1||a.y>1)return[];if(!this.object3D.visible||!this.isAllParentVisible(this.object3D))return[];e.setFromCamera(a,this.camera);var n=[];n.push(this.object3D);for(var r=0;r<this.object3D.children.length;r++)n.push(this.object3D.children[r]);return e.intersectObjects(n,!0)},this.isIntersect=function(t,e,o){return this.getIntersects(t,e,o).length>0},this.isAllParentVisible=function(t){var e=!0;return t.parent&&(e=!!t.parent.visible&&a(t.parent)),e},this.getMousePosition=function(t,e){var o=0,a=0;if("touchstart"===t.type?(o=t.touches[0].pageX,a=t.touches[0].pageY):"touchend"===t.type?(o=t.changedTouches[0].pageX,a=t.changedTouches[0].pageY):(o=t.clientX,a=t.clientY),o/=e.clientWidth,a/=e.clientHeight,this.camera.viewPort){var n=this.camera.viewPort.left/i.screenWidth,r=this.camera.viewPort.top/i.screenHeight;o=(o-n)/(this.camera.viewPort.width/i.screenWidth),a=(a-r)/(this.camera.viewPort.height/i.screenHeight)}var s=new THREE.Vector2;return s.x=2*o-1,s.y=2*-a+1,s}},r=function(){};r.events=[],r.vrEnabled=!1,r.listen=function(t){function e(){r.vrEnabled?o():(l=null,null!==s&&(clearTimeout(s),s=null)),requestAnimationFrame(e)}function o(){var t=a(null,n,!0);l!==t&&(clearTimeout(s),null!==t&&(s=setTimeout(function(){t.onclick(t.object3D)},VRParams.gazeTime))),l=t}function i(e){var o=a(e,n);o&&o.process(e,n,t)}function a(e,o,i){for(var a=null,n=null,s=0;s<r.events.length;s++){var l=r.events[s];if(l.findCamera()){if(l.enabled){var c=l.getFirstIntersect(e,o,t,i);c&&(!n||c.distance<n)&&(a=l,n=c.distance)}}else console.log("No render camera")}return a}var n=new THREE.Raycaster,s=null,l=null;document.attachEvent?(t.attachEvent("touchstart",i,!1),t.attachEvent("touchend",i,!1),t.attachEvent("mousedown",i,!1),t.attachEvent("mouseup",i,!1)):(t.addEventListener("touchstart",i,!1),t.addEventListener("touchend",i,!1),t.addEventListener("mousedown",i,!1),t.addEventListener("mouseup",i,!1)),e()},r.findCamera=function(t,e){if(-1!==t.type.indexOf("Camera")&&t.layers.mask===e)return t;for(var o=null,i=t.children,a=0;a<i.length&&null===(o=r.findCamera(i[a],e));a++);return o},r.get=function(t){for(var e=0;e<r.events.length;e++)if(r.events[e].object3D===t)return r.events[e];var o=new n;return o.object3D=t,r.events.push(o),o},t.exports=r},function(t,e){function o(t,e){void 0===e&&(e={});var o=e.hasOwnProperty("fontface")?e.fontface:"Arial",a=e.hasOwnProperty("fontsize")?e.fontsize:18,n=e.hasOwnProperty("borderThickness")?e.borderThickness:0,r=e.hasOwnProperty("borderColor")?e.borderColor:{r:0,g:0,b:0,a:1},s=e.hasOwnProperty("backgroundColor")?e.backgroundColor:{r:255,g:255,b:255,a:1},l=e.hasOwnProperty("cornerAngle")?e.cornerAngle:10,c=document.createElement("canvas");c.width=20*a,c.height=1.7*a;var h=c.getContext("2d");h.font="normal "+a+"px "+o,h.textAlign="center",h.textBaseline="middle";var u=h.measureText(t).width,m=(c.width+n)/2,d=(c.height+n)/2;h.fillStyle="rgba("+s.r+","+s.g+","+s.b+","+s.a+")",h.strokeStyle="rgba("+r.r+","+r.g+","+r.b+","+r.a+")",h.lineWidth=n;var p=1.25*a+15;i(h,(c.width-u-p)/2,0,u+p,c.height,l),h.fillStyle="rgba(255, 255, 255, 1.0)",h.fillText(t,m,d);var g=new THREE.Texture(c);return g.minFilter=THREE.LinearFilter,g.needsUpdate=!0,g.parameters=e,g.scaleX=.05*c.width,g.scaleY=.05*c.height,g}function i(t,e,o,i,a,n){t.beginPath(),t.moveTo(e+n,o),t.lineTo(e+i-n,o),t.quadraticCurveTo(e+i,o,e+i,o+n),t.lineTo(e+i,o+a-n),t.quadraticCurveTo(e+i,o+a,e+i-n,o+a),t.lineTo(e+n,o+a),t.quadraticCurveTo(e,o+a,e,o+a-n),t.lineTo(e,o+n),t.quadraticCurveTo(e,o,e+n,o),t.closePath(),t.fill(),t.stroke()}var a=function(){};a.createTextSprite=function(t,e){var i=o(t,e),a=new THREE.SpriteMaterial({map:i}),n=new THREE.Sprite(a);return n.scale.set(i.scaleX,i.scaleY,1),n.defaultScale=(new THREE.Vector3).copy(n.scale),n},t.exports=a},function(t,e){var o={PanoramaManager:0,FloorPlanManager:1,StereoHouse:2};t.exports=o},function(t,e,o){var i=o(1),a=o(0),n=o(2),r=o(15),s=o(9),l=o(6),c=o(5),h=o(3),u=o(7),m=o(16),d=function(){var t={duration:350};this.setCubeOpacity=function(t,e){for(var o=0;o<t.material.length;o++)t.material[o].opacity=e},this.setCubeTransparent=function(t,e){for(var o=0;o<t.material.length;o++)t.material[o].transparent=e,t.material[o].depthWrite=e},s.call(this,t,t.duration)};d.prototype=new s,d.prototype.play=function(t,e,o,i){var a={blurPanoramaCube:t,clearPanoramaCube:e,startOpacity:o,onFinished:i};this.params=Object.assign(this.params,a),this.params.duration=o*this.params.duration,s.prototype.play.call(this)},d.prototype.update=function(t,e){var o=t.startOpacity*(1-e);this.setCubeOpacity(t.blurPanoramaCube,o),t.clearPanoramaCube.visible||(t.clearPanoramaCube.visible=!0,t.clearPanoramaCube.rotation.copy(t.blurPanoramaCube.rotation),t.clearPanoramaCube.scale.set(2,2,2),t.blurPanoramaCube.scale.set(1,1,1),this.setCubeTransparent(t.blurPanoramaCube,!0),this.setCubeTransparent(t.clearPanoramaCube,!1),this.setCubeOpacity(t.clearPanoramaCube,1))},d.prototype.onFinished=function(t){t.blurPanoramaCube.visible=!1,this.setCubeTransparent(t.blurPanoramaCube,!0),this.setCubeTransparent(t.clearPanoramaCube,!0),t.onFinished&&t.onFinished(t)};var p=function(){function t(t,e){for(var o=0;o<e.length;o++)t.material[o].map=e[o]}function e(t,e){for(var o=0;o<t.material.length;o++)t.material[o].opacity=e}function o(){a.isPhone||p.isRotationTipShowed||($(h.rotationTip).fadeIn(2e3,function(){setTimeout(function(){$(h.rotationTip).fadeOut(1500)},1500)}),p.isRotationTipShowed=!0)}function u(t){for(var e=0;e<t.material.length;e++)null!==t.material[e].map&&(t.material[e].map.dispose(),t.material[e].map=null)}i.Object.call(this);var d=new THREE.Object3D;this.setObject3D(d);var p=this;this.setHighlightHotSpotPosition=function(){},this.onCameraRotate=function(){},this.onStartLoadPanoramaImage=function(t){},this.createPanoramaCube=function(){for(var t=[],e=0;e<6;e++)t.push(new THREE.MeshBasicMaterial({side:THREE.BackSide,transparent:!0,alphaTest:.1,depthWrite:!0}));var o=new THREE.Mesh(new THREE.CubeGeometry(1e4,1e4,1e4),t);return o.rotation.reorder("YXZ"),o},this.createLogoPlane=function(){var t=n.loadTexture("src/images/logo.png");this.texture=t,t.minFilter=THREE.NearestFilter;var e=new THREE.PlaneBufferGeometry(g.logoSize,g.logoSize,1,1),o=new THREE.MeshBasicMaterial({map:t,transparent:!0,alphaTest:.5}),i=new THREE.Mesh(e,o);return i.rotation.x=THREE.Math.degToRad(270),i.position.y=-400,i},this.getBlurPanoramaImageUrls=function(t){var e=[];if(t.BlurTileImagesPath&&t.BlurTileImagesPath.length>=6)for(var o in t.TileImagesPath)e.push(a.housePathPrefix+t.BlurTileImagesPath[o]);return e},this.getPanoramaImageUrls=function(t){var e=[];for(var o in t.TileImagesPath)e.push(a.housePathPrefix+t.TileImagesPath[o]);return e},this.loadPanoramaImage=function(e,o,i){if(this.isAnyHotSpotLoaded||(this.isAnyHotSpotLoaded=!0),this.currentHotSpotID!==e.ID&&!p.isLoadingPanoramaImage){this.isLoadingPanoramaImage=!0,this.currentHotSpotID=e.ID,this.onStartLoadPanoramaImage(e.ID);var r;!e.cached&&a.enableBlurLoading?(h.loading.style.visibility="visible",r=this.getBlurPanoramaImageUrls(e),n.loadTextures(r,null,function(a){p.onPanoramaImageLoad(a,e,o,i),p.loadingClearTextures=n.loadTextures(p.getPanoramaImageUrls(e),null,function(o){e.cached=!0,p.loadingClearTextures=null,p.cubeFadeAnimation.isPlaying?p.cubeFadeAnimation.progress>=.5&&(p.cubeFadeAnimation.stop(),t(p.cubeFadeAnimation.params.visibleCube,o),p.blurLoadingAnimation.play(p.cubeFadeAnimation.params.invisibleCube,p.cubeFadeAnimation.params.visibleCube,p.cubeFadeAnimation.params.invisibleCube.material[0].opacity)):(t(p.cubeFadeAnimation.params.visibleCube,o),p.blurLoadingAnimation.play(p.cubeFadeAnimation.params.invisibleCube,p.cubeFadeAnimation.params.visibleCube,p.cubeFadeAnimation.params.invisibleCube.material[0].opacity,function(t){u(t.blurPanoramaCube)}))})},null,null)):(e.cached||(h.loading.style.visibility="visible"),r=this.getPanoramaImageUrls(e),n.loadTextures(r,null,function(t){e.cached=!0,p.onPanoramaImageLoad(t,e,o,i)},null,null))}},this.onPanoramaImageLoad=function(e,o,i,r){h.loading.style.visibility="hidden",this.stopCubeFadeAnimation(),this.blurLoadingAnimation.stop(),p.loadingClearTextures&&(n.cancelTextures(p.loadingClearTextures),p.loadingClearTextures=null);var s=this.panoramaCube1.visible?this.panoramaCube1:this.panoramaCube2,l=this.panoramaCube1.visible?this.panoramaCube2:this.panoramaCube1;l.name=o.Name;var c=!this.panoramaCube1.visible&&!this.panoramaCube2.visible;this.playCubeFadeAnimation(s,l,o,c,i,r),t(l,e),o.Rotation&&l.rotation.set(THREE.Math.degToRad(o.Rotation.x),THREE.Math.degToRad(180-o.Rotation.y),THREE.Math.degToRad(-o.Rotation.z)),a.isSingleMode||(this.setHighlightHotSpotPosition(o),this.setPositionsToHotSpot(o));for(var u in this.hotSpotGroups){var m=(new THREE.Vector3).subVectors(this.camera.position,this.hotSpotGroups[u].position);this.hotSpotGroups[u].thetaX=Math.atan2(m.z,m.y),this.hotSpotGroups[u].thetaY=Math.atan2(m.z,m.x)}this.hotSpotGroups&&(this.clickedHotSpotGroup=this.hotSpotGroups[o.ID]),this.isLoadingPanoramaImage=!1},this.createCamera=function(){var t=i.screenWidth/i.screenHeight,e=new THREE.PerspectiveCamera(g.defaultFov,t,.5,1e5);return e.name="PanoramaManager",e.rotation.reorder("YXZ"),e},this.addPanoramaControlsToCamera=function(t){var e=new r(t,this.renderer.domElement);return e.onCameraRotate=function(){p.onCameraRotate()},e},this.createHotSpotGroup=function(t,e){function o(){var t=Date.now()/1e3,e=1.2+.2*Math.sin(5*t),i=.25*e;s.scale.set(i,i,i);var a=.6*e;c.scale.set(a,a,a);var n=e;h.scale.set(n,n,n),requestAnimationFrame(o)}var i=new THREE.Group;i.hotSpotData=t,i.name=t.Name,i.visible=!1;var n=t.Position.y-20;i.position.set(t.Position.x,n,-t.Position.z);var r=new THREE.Sprite(new THREE.SpriteMaterial({opacity:0}));r.name="spriteGroup",i.add(r),r.scale.set(10,10,1);var s=new THREE.Sprite(new THREE.SpriteMaterial({map:e,opacity:1}));r.add(s),s.scale.set(.25,.25,1);var c=new THREE.Sprite(new THREE.SpriteMaterial({map:e,opacity:.6}));r.add(c),c.scale.set(.75,.75,1);var h=new THREE.Sprite(new THREE.SpriteMaterial({map:e,opacity:.2}));if(r.add(h),h.scale.set(1,1,1),o(),a.displayRoomName){var u=l.createTextSprite(t.Name,{fontsize:80,backgroundColor:{r:0,g:0,b:0,a:.5},cornerAngle:75,borderColor:{r:0,g:0,b:0,a:0}});u.name="hotSpotNameSprite",i.add(u),u.y=7.5,u.position.set(0,u.y,0)}return i},this.registEventListener=function(){for(var t in this.hotSpotGroups)c.get(this.hotSpotGroups[t]).onclick=this.onHotSpotClicked},this.onHotSpotClicked=function(t){p.loadPanoramaImage(t.hotSpotData)},this.hideAllHotSpotGoups=function(){for(var t in this.hotSpotGroups)this.setVisibleIncludeChildren(this.hotSpotGroups[t],!1)},this.showVisibleHotSpotGroups=function(t){for(var e in t.VisibleHotSpotIds){var o=this.hotSpotGroups[t.VisibleHotSpotIds[e]];this.setVisibleIncludeChildren(o,!0)}},this.onZoomInClicked=function(){this.onZoomBtnClicked(!0)},this.onZoomOutClicked=function(){this.onZoomBtnClicked(!1)},this.onZoomBtnClicked=function(t){t&&this.camera.fov===g.minFov||(t||this.camera.fov!==g.maxFov)&&(this.cameraZoomAnimation&&this.cameraZoomAnimation.isPlaying||(this.targetZoomFov=t?this.camera.fov-this.zoomDelta:this.camera.fov+this.zoomDelta,this.targetZoomFov=Math.max(g.minFov,Math.min(g.maxFov,this.targetZoomFov)),this.playCameraZoomAnimation(this.camera.fov)))},this.onSwitchFullScreen=function(){if(a.isFullScreenInNewTab)window.open(window.location.href.replace("&fsnewtab=true",""));else{var t=!h.fullScreenButton.isFullScreen;h.fullScreenButton.isFullScreen=t,h.fullScreenButton.style.backgroundImage="url(images/"+(t?"exitFullScreen":"fullScreen")+".png)",Util.setFullScreen(t)}},this.playCubeFadeAnimation=function(t,i,a,n,r,l){function c(t){if(t.showBestCameraView&&t.hotSpotData.BestCameraView){var e=-t.hotSpotData.BestCameraView.x,o=-t.hotSpotData.Rotation.y-t.hotSpotData.BestCameraView.y;(e=(e+360)%360)>180&&(e-=360),o=(o+360)%360,p.camera.rotation.x=THREE.Math.degToRad(e),p.camera.rotation.y=THREE.Math.degToRad(o),p.camera.rotation.x=0}}var h={duration:1e3,beginFov:p.camera.fov,fadeInFov:p.camera.fov+1,visibleCube:t,invisibleCube:i,hotSpotData:a,isHotSpotsShowed:!1,onlyFadeOut:n,isStartFadeOut:!1,showBestCameraView:r,isAutoRotate:l};m.isInVRMode&&(h.duration=1),this.cubeFadeAnimation?(this.cubeFadeAnimation.params=h,this.cubeFadeAnimation.duration=h.duration):this.cubeFadeAnimation=new s(h,h.duration,function(t,o){function i(t,o){t.invisibleCube.visible=!0,e(t.invisibleCube,o),p.camera.fov=t.fadeInFov+(p.targetZoomFov-t.fadeInFov)*o,o>.1&&!t.isHotSpotsShowed&&(p.hotSpotGroups&&p.showVisibleHotSpotGroups(t.hotSpotData),t.isHotSpotsShowed=!0),t.isStartFadeOut||(t.isStartFadeOut=!0,c(t))}t.onlyFadeOut?i(t,o):o<=.5?(o*=2,e(t.visibleCube,1-o),p.camera.fov=t.beginFov+(t.fadeInFov-t.beginFov)*o):i(t,o=2*(o-.5)),p.camera.updateProjectionMatrix()},function(t){t.visibleCube.visible=!1,e(t.visibleCube,0),t.invisibleCube.visible=!0,e(t.invisibleCube,1),u(t.visibleCube),p.camera.fov=p.targetZoomFov,p.panoramaControls.isAutoPlay=t.isAutoRotate,o()}),this.hideAllHotSpotGoups(),this.cubeFadeAnimation.play()},this.stopCubeFadeAnimation=function(){this.cubeFadeAnimation&&this.cubeFadeAnimation.isPlaying&&this.cubeFadeAnimation.stop()},this.playCameraZoomAnimation=function(t){var e={beginFov:t};this.cameraZoomAnimation?this.cameraZoomAnimation.params=e:this.cameraZoomAnimation=new s(e,350,function(t,e){p.camera.fov=t.beginFov+(p.targetZoomFov-t.beginFov)*e,p.camera.updateProjectionMatrix()},function(){p.camera.fov=p.targetZoomFov,p.camera.updateProjectionMatrix(),p.camera.fov===g.minFov?$(h.zoomInButton).addClass("disabled"):$(h.zoomInButton).removeClass("disabled"),p.camera.fov===g.maxFov?$(h.zoomOutButton).addClass("disabled"):$(h.zoomOutButton).removeClass("disabled")}),this.cameraZoomAnimation.play()},this.setPositionsToHotSpot=function(t){var e=(new THREE.Vector3).copy(t.Position);e.z=-e.z,this.camera.position.copy(e),this.panoramaCube1.position.copy(e),this.panoramaCube2.position.copy(e),this.logoPlane.position.set(t.Position.x,-400,-t.Position.z)},this.updateCameraRotation=function(t){this.camera.rotation.setFromVector3(t)},this.setTargetZoomFov=function(t){t&&(this.targetZoomFov=t)},this.updateHotSpotScale=function(){if(this.clickedHotSpotGroup)for(var t in this.clickedHotSpotGroup.hotSpotData.VisibleHotSpotIds){var e=this.hotSpotGroups[this.clickedHotSpotGroup.hotSpotData.VisibleHotSpotIds[t]];if(e){var o=this.camera.position.distanceTo(e.position),i=Math.abs(o*Math.sin(this.camera.rotation.y+e.thetaY)*Math.cos(this.camera.rotation.x/2));e.getObjectByName("spriteGroup").scale.set(.08*i,.08*i,1);var a=e.getObjectByName("hotSpotNameSprite");a&&(a.position.y=a.y*i*.015,a.scale.set(a.material.map.scaleX*i*.015,a.material.map.scaleY*i*.015,1),a.material.rotation=-p.camera.rotation.z)}}}};p.getPanoramaImageUrls=function(t){var e=[];for(var o in t.TileImagesPath)a.enableBlurLoading&&!t.cached?e.push(a.housePathPrefix+t.BlurTileImagesPath[o]):e.push(a.housePathPrefix+t.TileImagesPath[o]);return e},p.getPrepareResourceUrls=function(t){return t.BlurTileImagesPath&&t.BlurTileImagesPath.length>=6||(a.enableBlurLoading=!1),p.getPanoramaImageUrls(t)},p.prototype=new i.Object,p.prototype.init=function(t){var e=this;if(this.camera=this.createCamera(),this.scene=this.getScene(),this.renderer=this.getRenderer(),this.houseData=t,this.panoramaCube1=this.createPanoramaCube(),this.panoramaCube2=this.createPanoramaCube(),this.logoPlane=this.createLogoPlane(),this.panoramaControls=this.addPanoramaControlsToCamera(this.camera),this.panoramaControls.autoRotateSpeed=g.autoRotateSpeed,this.currentHotSpotID=null,this.targetZoomFov=g.defaultFov,this.zoomDelta=(g.maxFov-g.minFov)/(g.zoomSteps-1),this.isLoadingPanoramaImage=!1,this.isRotationTipShowed=!1,this.cubeFadeAnimation=null,this.cameraZoomAnimation=null,this.blurLoadingAnimation=new d,this.loadingClearTextures=null,this.isAnyHotSpotLoaded=!1,this.object3D.add(this.camera),!a.isSingleMode){this.hotSpotGroups={},this.clickedHotSpotGroup=null;var o=n.loadTexture("src/images/hotspot_sprite.png");for(var i in t.HotSpots){var r=this.createHotSpotGroup(t.HotSpots[i],o);this.hotSpotGroups[t.HotSpots[i].ID]=r,this.object3D.add(r)}this.registEventListener()}this.object3D.add(this.logoPlane),this.object3D.add(this.panoramaCube1),this.object3D.add(this.panoramaCube2),this.panoramaCube1.visible=!1,this.panoramaCube2.visible=!1,this.panoramaCube1.scale.set(2,2,2),$(h.zoomInButton).click(function(){e.onZoomInClicked()}),$(h.zoomOutButton).click(function(){e.onZoomOutClicked()}),this.setLayer(u.PanoramaManager)},p.prototype.update=function(){this.renderer.setViewport(0,0,i.screenWidth,i.screenHeight),this.renderer.render(this.scene,this.camera),this.onCameraRotationUpdateForFloorPlan&&this.onCameraRotationUpdateForFloorPlan(this.camera.rotation.y),this.onCameraRotationUpdateForStereoHouse&&this.onCameraRotationUpdateForStereoHouse(this.camera.rotation.y,this.panoramaControls.isAutoPlay),this.updateHotSpotScale()},p.prototype.onWindowResize=function(){this.camera.aspect=i.screenWidth/i.screenHeight,this.camera.updateProjectionMatrix()};var g={maxFov:100,minFov:50,zoomSteps:3,defaultFov:100,logoSize:250,isAutoRotateWhenStart:!0,autoRotateSpeed:.3};t.exports={PanoramaManager:p,PanoramaParams:g}},function(t,e){var o=function(t,e,o,i){var a=this,n=o;this._onFinished=i,this.isPlaying=!1,this.animationFrame=null,this.progress=0,this.params=t,this.duration=e||0,this.startTime=null,this.innerLoop=function(){if(this.isPlaying){var t=(new Date).getTime(),e=0;this.duration>0&&(e=(t-this.startTime)/this.duration),e>=1?(e=1,this.progress=e,n&&n(this.params,e),this.update(this.params,e),this.stop()):(this.progress=e,n&&n(this.params,e),this.update(this.params,e),this.animationFrame=requestAnimationFrame(function(){a.innerLoop()}))}}};o.prototype.update=function(t,e){},o.prototype.play=function(){return this.isPlaying=!0,this.startTime=(new Date).getTime(),this.innerLoop(),this},o.prototype.stop=function(){this.isPlaying&&(this.isPlaying=!1,this.animationFrame&&(cancelAnimationFrame(this.animationFrame),this.animationFrame=void 0),this._onFinished&&this._onFinished(this.params),this.onFinished(this.params))},o.prototype.onFinished=function(t){},t.exports=o},function(t,e,o){var i=o(0),a={size:{baseSize:i.isPhone?138:115,extraPixels:i.isPhone?2:4},leftBaseSize:i.isPhone?0:20,topBaseSize:i.isPhone?0:48,refBaseSize:i.isPhone?375:450,bgColor:0,bgOpacity:.7,smallViewMargin:1.05,hotSpotSize:40,hotSpotNameMarginTop:-48};t.exports=a},,function(t,e,o){var i=o(4),a="house/";a=i.getUrlParameter("domain")||a,window.pano={domain:a},o(13);var n=o(2),r=o(0),s=o(3),l=o(14);o(19),o(20);VRParams={gazeTime:1500,fov:93},HouseModel=function(){this.Floors=[],this.HotSpots=[],this.ID="",this.Name="",this.CameraHeight=0,this.HouseSize=void 0,this.CoverImagePath="",this.DefaultHotSpotId="",this.ClientVersion=""},Floor=function(){this.ID="",this.Name="",this.FloorSize=void 0,this.FloorPlanPath="",this.Rooms=[],this.FloorPlanCenterPoint=void 0,this.IsMatchCustomFloorPlan=!1},Room=function(){this.ID="",this.Name="",this.Position=void 0,this.Rotation=0,this.RoomFaces=[],this.HotSpotIds=[]},RoomFace=function(){this.Name="",this.Position=void 0,this.Rotation=void 0,this.Width=0,this.Height=0,this.ImagePath=""},HotSpot=function(){this.ID="",this.Name="",this.TileImagesPath=[],this.BlurTileImagesPath=[],this.ThumbnailPath="",this.Position=void 0,this.Rotation=void 0,this.BestCameraView=void 0,this.VisibleHotSpotIds=[]},runVRHouseApp=function(){function t(){r.isPhone?(r.isSingleMode||$(s.switchVRButton).show(),$($(s.largeViewSwitchController).removeClass("pc").addClass("phone").children()).removeClass("pc").addClass("phone"),$($(s.controllerLeft).removeClass("pc").addClass("phone").children()).removeClass("pc").addClass("phone"),$(s.vrHouseContainer).addClass("phone"),s.zoomInButton.className="controller_right_phone",s.zoomOutButton.className="controller_right_phone disabled",s.zoomInButton.style.backgroundImage="url(images/zoomInPhone.png)",s.zoomOutButton.style.backgroundImage="url(images/zoomOutPhone.png)"):$(s.fullScreenButton).show(),r.isSingleMode||(s.controllerLeft.style.visibility="visible")}function e(t){if(!t.ClientVersion)for(var e in t.HotSpots){var o=t.HotSpots[e];if(o.ImagePath){var i=o.ImagePath.replace("PanoramaImages","PanoramaTileImages");i.indexOf("PanoramaTileImages")<0&&(i="PanoramaTileImages/"+i);var a=(i=i.substring(0,i.lastIndexOf(".")))+"_",n=["l.jpg","r.jpg","u.jpg","d.jpg","f.jpg","b.jpg"];o.TileImagesPath=[];for(var r in n)o.TileImagesPath[r]=a+n[r]}}}n.getHouseViewData(function(o,i){if(o)if(document.title=o.Name,o.CoverImagePath&&""!==o.CoverImagePath&&(s.welcome.style.backgroundImage="url('"+r.housePathPrefix+o.CoverImagePath+"')"),0!==o.HotSpots.length){t(),e(o);var a=new l;a.init(s.vrHouseContainer,o),a.run()}else $(s.loadingTip).text("没有全景图片");else 404===i?$(s.loadingTip).text("您要浏览的房子不存在"):-1===i?$(s.loadingTip).text("数据格式错误"):$(s.loadingTip).text("出错了，请刷新重试")})},runVRHouseApp()},function(t,e){t.exports=function(){THREE.OrbitControls=function(t,e){function o(){return 2*Math.PI/60/60*x.autoRotateSpeed}function i(){return Math.pow(.95,x.zoomSpeed)}function a(t){O.theta-=t}function n(t){O.phi-=t}function r(t){x.object instanceof THREE.PerspectiveCamera?z/=t:x.object instanceof THREE.OrthographicCamera?(x.object.zoom=Math.max(x.minZoom,Math.min(x.maxZoom,x.object.zoom*t)),x.object.updateProjectionMatrix(),N=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),x.enableZoom=!1)}function s(t){x.object instanceof THREE.PerspectiveCamera?z*=t:x.object instanceof THREE.OrthographicCamera?(x.object.zoom=Math.max(x.minZoom,Math.min(x.maxZoom,x.object.zoom/t)),x.object.updateProjectionMatrix(),N=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),x.enableZoom=!1)}function l(t){W.set(t.clientX,t.clientY)}function c(t){X.set(t.clientX,t.clientY)}function h(t){Z.set(t.clientX,t.clientY)}function u(t){$.set(t.clientX,t.clientY),U.subVectors($,W);var e=x.domElement===document?x.domElement.body:x.domElement;a(2*Math.PI*U.x/e.clientWidth*x.rotateSpeed),n(2*Math.PI*U.y/e.clientHeight*x.rotateSpeed),W.copy($),x.update()}function m(t){q.set(t.clientX,t.clientY),Q.subVectors(q,X),Q.y>0?r(i()):Q.y<0&&s(i()),X.copy(q),x.update()}function d(t){Y.set(t.clientX,t.clientY),_.subVectors(Y,Z),tt(_.x,_.y),Z.copy(Y),x.update()}function p(t){t.deltaY<0?s(i()):t.deltaY>0&&r(i()),x.update()}function g(t){switch(t.keyCode){case x.keys.UP:tt(0,x.keyPanSpeed),x.update();break;case x.keys.BOTTOM:tt(0,-x.keyPanSpeed),x.update();break;case x.keys.LEFT:tt(x.keyPanSpeed,0),x.update();break;case x.keys.RIGHT:tt(-x.keyPanSpeed,0),x.update()}}function f(t){W.set(t.touches[0].pageX,t.touches[0].pageY)}function b(t){var e=t.touches[0].pageX-t.touches[1].pageX,o=t.touches[0].pageY-t.touches[1].pageY,i=Math.sqrt(e*e+o*o);X.set(0,i)}function v(t){Z.set(t.touches[0].pageX,t.touches[0].pageY)}function w(t){$.set(t.touches[0].pageX,t.touches[0].pageY),U.subVectors($,W);var e=x.domElement===document?x.domElement.body:x.domElement;a(2*Math.PI*U.x/e.clientWidth*x.rotateSpeed),n(2*Math.PI*U.y/e.clientHeight*x.rotateSpeed),W.copy($),x.update()}function S(t){var e=t.touches[0].pageX-t.touches[1].pageX,o=t.touches[0].pageY-t.touches[1].pageY,a=Math.sqrt(e*e+o*o);q.set(0,a),Q.subVectors(q,X),Q.y>0?s(i()):Q.y<0&&r(i()),X.copy(q),x.update()}function E(t){Y.set(t.touches[0].pageX,t.touches[0].pageY),_.subVectors(Y,Z),tt(_.x,_.y),Z.copy(Y),x.update()}function T(t){if(!1!==x.enabled){if(t.preventDefault(),t.button===x.mouseButtons.ORBIT){if(!1===x.enableRotate)return;l(t),k=j.ROTATE}else if(t.button===x.mouseButtons.ZOOM){if(!1===x.enableZoom)return;c(t),k=j.DOLLY}else if(t.button===x.mouseButtons.PAN){if(!1===x.enablePan)return;h(t),k=j.PAN}k!==j.NONE&&(document.addEventListener("mousemove",y,!1),document.addEventListener("mouseup",P,!1),x.dispatchEvent(F))}}function y(t){if(!1!==x.enabled)if(t.preventDefault(),k===j.ROTATE){if(!1===x.enableRotate)return;u(t)}else if(k===j.DOLLY){if(!1===x.enableZoom)return;m(t)}else if(k===j.PAN){if(!1===x.enablePan)return;d(t)}}function P(t){!1!==x.enabled&&(document.removeEventListener("mousemove",y,!1),document.removeEventListener("mouseup",P,!1),x.dispatchEvent(I),k=j.NONE)}function R(t){!1===x.enabled||!1===x.enableZoom||k!==j.NONE&&k!==j.ROTATE||(t.preventDefault(),t.stopPropagation(),p(t),x.dispatchEvent(F),x.dispatchEvent(I))}function H(t){!1!==x.enabled&&!1!==x.enableKeys&&!1!==x.enablePan&&g(t)}function C(t){if(!1!==x.enabled){switch(t.touches.length){case 1:if(!1===x.enableRotate)return;f(t),k=j.TOUCH_ROTATE;break;case 2:if(!1===x.enableZoom)return;b(t),k=j.TOUCH_DOLLY;break;case 3:if(!1===x.enablePan)return;v(t),k=j.TOUCH_PAN;break;default:k=j.NONE}k!==j.NONE&&x.dispatchEvent(F)}}function M(t){if(!1!==x.enabled)switch(t.preventDefault(),t.stopPropagation(),t.touches.length){case 1:if(!1===x.enableRotate)return;if(k!==j.TOUCH_ROTATE)return;w(t);break;case 2:if(!1===x.enableZoom)return;if(k!==j.TOUCH_DOLLY)return;S(t);break;case 3:if(!1===x.enablePan)return;if(k!==j.TOUCH_PAN)return;E(t);break;default:k=j.NONE}}function D(t){!1!==x.enabled&&(x.dispatchEvent(I),k=j.NONE)}function V(t){t.preventDefault()}this.object=t,this.domElement=void 0!==e?e:document,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return L.phi},this.getAzimuthalAngle=function(){return L.theta},this.reset=function(){x.target.copy(x.target0),x.object.position.copy(x.position0),x.object.zoom=x.zoom0,x.object.updateProjectionMatrix(),x.dispatchEvent(B),x.update(),k=j.NONE},this.update=function(){var e=new THREE.Vector3,i=(new THREE.Quaternion).setFromUnitVectors(t.up,new THREE.Vector3(0,1,0)),n=i.clone().inverse(),r=new THREE.Vector3,s=new THREE.Quaternion;return function(){var t=x.object.position;return e.copy(t).sub(x.target),e.applyQuaternion(i),L.setFromVector3(e),x.autoRotate&&k===j.NONE&&a(o()),L.theta+=O.theta,L.phi+=O.phi,L.theta=Math.max(x.minAzimuthAngle,Math.min(x.maxAzimuthAngle,L.theta)),L.phi=Math.max(x.minPolarAngle,Math.min(x.maxPolarAngle,L.phi)),L.makeSafe(),L.radius*=z,L.radius=Math.max(x.minDistance,Math.min(x.maxDistance,L.radius)),x.target.add(G),e.setFromSpherical(L),e.applyQuaternion(n),t.copy(x.target).add(e),x.object.lookAt(x.target),!0===x.enableDamping?(O.theta*=1-x.dampingFactor,O.phi*=1-x.dampingFactor):O.set(0,0,0),z=1,G.set(0,0,0),!!(N||r.distanceToSquared(x.object.position)>A||8*(1-s.dot(x.object.quaternion))>A)&&(x.dispatchEvent(B),r.copy(x.object.position),s.copy(x.object.quaternion),N=!1,!0)}}(),this.dispose=function(){x.domElement.removeEventListener("contextmenu",V,!1),x.domElement.removeEventListener("mousedown",T,!1),x.domElement.removeEventListener("wheel",R,!1),x.domElement.removeEventListener("touchstart",C,!1),x.domElement.removeEventListener("touchend",D,!1),x.domElement.removeEventListener("touchmove",M,!1),document.removeEventListener("mousemove",y,!1),document.removeEventListener("mouseup",P,!1),window.removeEventListener("keydown",H,!1)};var x=this,B={type:"change"},F={type:"start"},I={type:"end"},j={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},k=j.NONE,A=1e-6,L=new THREE.Spherical,O=new THREE.Spherical,z=1,G=new THREE.Vector3,N=!1,W=new THREE.Vector2,$=new THREE.Vector2,U=new THREE.Vector2,Z=new THREE.Vector2,Y=new THREE.Vector2,_=new THREE.Vector2,X=new THREE.Vector2,q=new THREE.Vector2,Q=new THREE.Vector2,K=function(){var t=new THREE.Vector3;return function(e,o){t.setFromMatrixColumn(o,0),t.multiplyScalar(-e),G.add(t)}}(),J=function(){var t=new THREE.Vector3;return function(e,o){t.setFromMatrixColumn(o,1),t.multiplyScalar(e),G.add(t)}}(),tt=function(){var t=new THREE.Vector3;return function(e,o){var i=x.domElement===document?x.domElement.body:x.domElement;if(x.object instanceof THREE.PerspectiveCamera){var a=x.object.position;t.copy(a).sub(x.target);var n=t.length();n*=Math.tan(x.object.fov/2*Math.PI/180),K(2*e*n/i.clientHeight,x.object.matrix),J(2*o*n/i.clientHeight,x.object.matrix)}else x.object instanceof THREE.OrthographicCamera?(K(e*(x.object.right-x.object.left)/x.object.zoom/i.clientWidth,x.object.matrix),J(o*(x.object.top-x.object.bottom)/x.object.zoom/i.clientHeight,x.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),x.enablePan=!1)}}();x.domElement.addEventListener("contextmenu",V,!1),x.domElement.addEventListener("mousedown",T,!1),x.domElement.addEventListener("wheel",R,!1),x.domElement.addEventListener("touchstart",C,!1),x.domElement.addEventListener("touchend",D,!1),x.domElement.addEventListener("touchmove",M,!1),window.addEventListener("keydown",H,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,THREE.VRControls=function(t,e){function o(){if(g.enabled){var t=g.camera,e=g.getVRState(),o=g.manualRotation.clone();if(t){if(!e)return void t.rotation.copy(o);var i=new THREE.Euler,a=e.hmd.rotation;if(0!==a[0]||0!==a[1]||0!==a[2]||0!==a[3]){var n=new THREE.Quaternion(a[0],a[1],a[2],a[3]);(i=(new THREE.Euler).setFromQuaternion(n).reorder("YXZ")).y-=Math.PI/2,i.x+=o.x,i.y+=o.y}else i=o;t.rotation.copy(i)}}}function i(){requestAnimationFrame(i),o()}function a(t,e){h=!0,u=t,d=g.manualRotation.y}function n(t,e){h&&g.enabled&&(m=(t-u)*g.speed*.002+d,g.manualRotation=new THREE.Euler(0,m,0).reorder("YXZ"))}function r(){h=!1}function s(t){t.preventDefault(),t.stopPropagation(),a(t.touches[0].pageX*g.speed*p,t.touches[0].pageY*g.speed*p)}function l(t){t.preventDefault(),t.stopPropagation(),n(t.touches[0].pageX*g.speed*p,t.touches[0].pageY*g.speed*p)}function c(t){t.preventDefault(),t.stopPropagation(),r()}var h=!1,u=0,m=0,d=0;this.phoneVR=new PhoneVR,this.camera=t,this.manualRotation=new THREE.Euler,this.enabled=!1,this.speed=1;var p=3,g=this;!function(t){null!==t&&void 0!==t||(t=document),t.addEventListener("touchstart",s,!1),t.addEventListener("touchend",c,!1),t.addEventListener("touchmove",l,!1)}(e),i(),this.resetSensor=function(){var t=this._vrInput;if(!t)return null;t.resetSensor()},this.getVRState=function(){var t,e=this._vrInput;if(e)t=e.getState().orientation;else{if(!this.phoneVR.rotationQuat())return null;t=this.phoneVR.rotationQuat()}return null===t?null:{hmd:{rotation:[t.x,t.y,t.z,t.w]}}}},THREE.StereoEffect=function(t){var e=new THREE.StereoCamera;e.aspect=.5,this.setEyeSeparation=function(t){e.eyeSep=t},this.setSize=function(e,o){t.setSize(e,o)},this.render=function(o,i){o.updateMatrixWorld(),null===i.parent&&i.updateMatrixWorld(),e.update(i);var a=t.getSize();t.clear(),t.setScissorTest(!0),t.setScissor(0,0,a.width/2,a.height),t.setViewport(0,0,a.width/2,a.height),t.render(o,e.cameraL),t.setScissor(a.width/2,0,a.width/2,a.height),t.setViewport(a.width/2,0,a.width/2,a.height),t.render(o,e.cameraR),t.setScissorTest(!1)}}}()},function(t,e,o){var i=o(1),a=o(0),n=o(5),r=o(3),s=o(8).PanoramaManager,l=o(2),c=o(8).PanoramaParams,h=o(17),u=o(18),m=function(t,e){var o,n,s,l={},c=0,h=function(t){var e=[];for(var o in t.HotSpots){var i=t.HotSpots[o],n=a.housePathPrefix+(i.ThumbnailPath||"ThumbnailImages/"+i.ImagePath);n=n.replace("\\","/"),e.push({name:i.Name,imagePath:n})}return e}(t);s=h.length;var u=parseInt((i.screenWidth-28)/110),m=[],d=this,p=!1;a.isPhone&&($(r.thumbnailControlButton).addClass("phone expand").hover(function(){$(this).toggleClass("expand collap")}),$(r.thumbnailList).addClass("phone")),$(r.thumbnailControlButton).click(function(){"none"==r.thumbnailList.style.display?(a.isPhone&&(this.style.backgroundImage="url(images/thumbnailPhone.png)"),$(r.thumbnailList).slideDown("slow")):(a.isPhone&&(this.style.backgroundImage="url(images/thumbnailPhonePress.png)"),$(r.thumbnailList).slideUp("slow"))}),this.loadThumbnail=function(){r.thumbnailController.style.visibility="visible",p=!0,u<s&&(u=parseInt((i.screenWidth-50)/110)),a.isPhone&&(u=parseInt(i.screenWidth/73));for(var c in h){var d=a.displayRoomName?"inline-block":"none",g=document.createElement("div");g.className=a.isPhone?"thumbnail_group phone":"thumbnail_group",g.innerHTML='<div class="thumbnail-normal thumbnail-unselected '+(a.isPhone?"phone":"")+'"><div style="background: url(\''+h[c].imagePath+'\') no-repeat center;background-size: cover;background-position-x: 0;"></div><div class="thumbnail-caption text-overlay-bg-trans"><span class="thumbnail_name" style="display: '+d+'">'+h[c].name+"</span></div></div>",c>=u&&!a.isPhone&&(g.style.display="none"),g.index=parseInt(c),g.onclick=function(){n!=this.index&&e(t.HotSpots[this.index])},l[t.HotSpots[c].ID]=g,$(r.thumbnails).append(g),m.push(g)}$(m[0].children.item(0)).removeClass("thumbnail-unselected"),o=m[0],n=0,a.isPhone||(u<s&&($(r.naviLeft).show(),$(r.naviRight).show()),$(r.naviLeft).addClass("disabled").click(function(){n>0&&e(t.HotSpots[n-1])}),$(r.naviRight).click(function(){n+1<s&&e(t.HotSpots[n+1])}))},this.moveThumbnails=function(){var t=parseInt((i.screenWidth-28)/110);a.isPhone?t=parseInt(i.screenWidth/73):t<s?(t=parseInt((i.screenWidth-50)/110),$(r.naviLeft).show(),$(r.naviRight).show()):($(r.naviLeft).hide(),$(r.naviRight).hide());var e=parseInt(t/2),o=Math.max(n-e,0),l=Math.min(o+t-1,s-1),h=Math.min(c+u-1,s-1);if(a.isPhone)r.thumbnailList.scrollLeft=73*o;else{for(;o<c;)m[--c].style.display="inline-block";for(;o>c;)m[c++].style.display="none";for(;l<h;)m[++l].style.display="none";for(;l>h;)m[l--].style.display="inline-block"}u=t,c=o},this.setSelectedThumbnailVisible=function(){var t=Math.min(c+u-1,s-1);if(n<c||n>t){var e=parseInt(u/2),o=Math.max(n-e,0),i=Math.min(o+u-1,s-1);if(i==s-1&&(o=s-u),a.isPhone)r.thumbnailList.scrollLeft=73*o;else{for(l=c;l<=t;++l)m[l].style.display="none";for(var l=o;l<=i;++l)m[l].style.display="inline-block"}c=o}},this.selectThumbnail=function(t){p||d.loadThumbnail(),l[t]!=o&&(o&&$(o.children.item(0)).addClass("thumbnail-unselected"),$(l[t].children.item(0)).removeClass("thumbnail-unselected"),o=l[t],n=o.index,a.isPhone||(0==n?$(r.naviLeft).addClass("disabled"):$(r.naviLeft).removeClass("disabled"),n+1==s?$(r.naviRight).addClass("disabled"):$(r.naviRight).removeClass("disabled")),d.setSelectedThumbnailVisible())},this.onWindowResize=function(){d.moveThumbnails()}},d=function(){i.App.call(this);var t=this;this.onSwitch2DBtnClicked=function(){r.switch2DButton.isPressed||(t.stopHouseSmallViewAutoRotateTimer(),t.floorPlanManager.object3D.visible=!0,t.stereoHouseManager.object3D.visible=!1,t.stereoHouseManager.enableSmallViewAutoRotate(!1),this.onSwitchBtnClicked(r.switch2DButton,this.floorPlanSwitchBtnGroup))},this.onSwitch3DBtnClicked=function(){r.switch3DButton.isPressed||(t.stopHouseSmallViewAutoRotateTimer(),t.floorPlanManager.object3D.visible=!1,t.stereoHouseManager.object3D.visible=!0,t.stereoHouseManager.enableSmallViewAutoRotate(!1),this.onSwitchBtnClicked(r.switch3DButton,this.floorPlanSwitchBtnGroup))},this.onLargeViewSwitch2DBtnClicked=function(){r.largeViewSwitch2DButton.isPressed||(this.onSwitchBtnClicked(r.largeViewSwitch2DButton,this.largeViewSwitchBtnGroup),this.onSwitch2DBtnClicked(),this.floorPlanManager.isSmallView&&this.floorPlanManager.switchToLargeView(),t.stereoHouseManager.orbitControls.enabled=!1,r.enterHotSpotTip.style.visibility="hidden")},this.onLargeViewSwitch3DBtnClicked=function(){r.largeViewSwitch3DButton.isPressed||(this.onSwitchBtnClicked(r.largeViewSwitch3DButton,this.largeViewSwitchBtnGroup),this.onSwitch3DBtnClicked(),this.stereoHouseManager.isSmallView&&this.stereoHouseManager.switchToLargeView(),t.stereoHouseManager.orbitControls.enabled=!0,r.enterHotSpotTip.style.visibility="visible")},this.onSwitchAutoBtnClicked=function(){r.switchAutoButton.isPressed||(this.startHouseSmallViewAutoRotateTimer(),this.onSwitchBtnClicked(r.switchAutoButton,this.floorPlanSwitchBtnGroup))},this.onSwitchBtnClicked=function(t,e){for(var o in e){var i=e[o];$(i).removeClass("switchButtonPressed").removeClass("switchButton"),i.isPressed=i===t;var a=i.isPressed?"switchButtonPressed":"switchButton";$(i).addClass(a)}},this.onVRBtnClicked=function(){var t=!r.switchVRButton.enabled;if(r.switchVRButton.enabled=t,this.vrManager.enable(t),this.panoramaManager.panoramaControls.enabled=!t,t)$(r.controllerLeft).hide(),$(r.thumbnailController).hide(),r.switchVRButton.style.backgroundImage="url(images/vrPress.png)",this.stopHouseSmallViewAutoRotateTimer(),this.floorPlanManager.object3D.visible=!1,this.stereoHouseManager.object3D.visible=!1;else{$(r.controllerLeft).show(),$(r.thumbnailController).show(),r.switchVRButton.style.backgroundImage="url(images/vr.png)";for(var e in this.floorPlanSwitchBtnGroup){var o=this.floorPlanSwitchBtnGroup[e];if(o.isPressed){o.isPressed=!1,o===r.switchAutoButton?(this.stereoHouseManager.object3D.visible=!0,this.onSwitchAutoBtnClicked()):o===r.switch2DButton?this.onSwitch2DBtnClicked():o===r.switch3DButton&&this.onSwitch3DBtnClicked();break}}this.panoramaManager.updateCameraRotation(new THREE.Vector3(0,this.panoramaManager.camera.rotation.y,0))}},this.startHouseSmallViewAutoRotateTimer=function(){this.stopHouseSmallViewAutoRotateTimer(),r.switchAutoButton.timeout=setTimeout(function(){t.panoramaManager.object3D.visible&&(t.floorPlanManager.object3D.visible=!1,t.stereoHouseManager.object3D.visible=!0,t.stereoHouseManager.enableSmallViewAutoRotate(!0))},a.switchAutoTimeout)},this.stopHouseSmallViewAutoRotateTimer=function(){clearTimeout(r.switchAutoButton.timeout)},this.onPanoramaCameraRotate=function(){t.vrManager&&t.vrManager.object3D.visible||r.switchAutoButton.isPressed&&t.panoramaManager.object3D.visible&&(t.floorPlanManager.object3D.visible||(t.floorPlanManager.object3D.visible=!0,t.stereoHouseManager.object3D.visible=!1),t.stereoHouseManager.enableSmallViewAutoRotate(!1),t.startHouseSmallViewAutoRotateTimer())},this.onThumbnailClicked=function(e){t.switchToPanoramaView(),t.panoramaManager.loadPanoramaImage(e,!0)},this.onHotSpotClicked=function(e){t.panoramaManager.loadPanoramaImage(e),t.switchToPanoramaView()},this.switchToPanoramaView=function(){t.stereoHouseManager.isSmallView||(a.isPlayCameraFlyAnimation?t.stereoHouseManager.switchToSmallViewWithAnimation(hotSpotData):t.stereoHouseManager.switchToSmallView()),t.floorPlanManager.isSmallView||t.floorPlanManager.switchToSmallView()},this.getDefaultHotSpot=function(t){var e=t.HotSpots[0];if(t.DefaultHotSpotId&&""!==t.DefaultHotSpotId)for(var o in t.HotSpots)t.HotSpots[o].ID===t.DefaultHotSpotId&&(e=t.HotSpots[o]);return e},this.onEnterPanoramaViewBtnClicked=function(){t.panoramaManager.isAnyHotSpotLoaded?t.switchToPanoramaView():t.onHotSpotClicked(t.getDefaultHotSpot(t.houseData))},this.bindControlEvents=function(){t.onSwitchAutoBtnClicked(),t.panoramaManager.setHighlightHotSpotPosition=t.floorPlanManager.setHighlightHotSpotPosition,t.panoramaManager.onCameraRotate=t.onPanoramaCameraRotate,t.panoramaManager.onCameraRotationUpdateForFloorPlan=t.floorPlanManager.onPanoramaCameraRotationUpdate,t.panoramaManager.onCameraRotationUpdateForStereoHouse=t.stereoHouseManager.onPanoramaCameraRotationUpdate,t.floorPlanManager.onHotSpotClick=t.onHotSpotClicked,t.stereoHouseManager.onHotSpotClicked=t.onHotSpotClicked,t.stereoHouseManager.onHotSpotClicked=t.onHotSpotClicked,t.stereoHouseManager.onSwitchToLargeView=function(){t.panoramaManager.object3D.visible=!1,t.onSwitchBtnClicked(r.largeViewSwitch3DButton,t.largeViewSwitchBtnGroup),$(r.controllerLeft).hide(),$(r.zoomInButton).hide(),$(r.zoomOutButton).hide(),r.largeViewSwitchController.style.visibility="visible"},t.stereoHouseManager.onSwitchToSmallView=function(){t.panoramaManager.object3D.visible=!0,t.panoramaManager.updateCameraRotation(new THREE.Vector3(0,t.stereoHouseManager.camera.rotation.y,0)),$(r.controllerLeft).show(),$(r.zoomInButton).show(),$(r.zoomOutButton).show(),r.largeViewSwitchController.style.visibility="hidden"},t.floorPlanManager.onSwitchToLargeView=function(){t.panoramaManager.object3D.visible=!1,t.onSwitchBtnClicked(r.largeViewSwitch2DButton,t.largeViewSwitchBtnGroup),$(r.controllerLeft).hide(),$(r.zoomInButton).hide(),$(r.zoomOutButton).hide(),r.largeViewSwitchController.style.visibility="visible"},t.floorPlanManager.onSwitchToSmallView=function(){t.panoramaManager.object3D.visible=!0,t.panoramaManager.updateCameraRotation(new THREE.Vector3(0,t.panoramaManager.camera.rotation.y,0)),$(r.controllerLeft).show(),$(r.zoomInButton).show(),$(r.zoomOutButton).show(),r.largeViewSwitchController.style.visibility="hidden"},$(r.switchAutoButton).click(function(){t.onSwitchAutoBtnClicked()}),$(r.switch2DButton).click(function(){t.onSwitch2DBtnClicked()}),$(r.switch3DButton).click(function(){t.onSwitch3DBtnClicked()}),$(r.largeViewSwitch2DButton).click(function(){t.onLargeViewSwitch2DBtnClicked()}),$(r.largeViewSwitch3DButton).click(function(){t.onLargeViewSwitch3DBtnClicked()}),$(r.enterPanoramaViewBtn).click(this.onEnterPanoramaViewBtnClicked),$(r.switchVRButton).click(function(){t.onVRBtnClicked()})},this.loadPanoramaManager=function(e){this.panoramaManager=new s,this.addObject(this.panoramaManager),this.panoramaManager.init(e),$(r.fullScreenButton).click(function(){t.panoramaManager.onSwitchFullScreen()})},this.loadThumbnailManager=function(t){this.thumbnailManager=new m(t,this.onThumbnailClicked),this.panoramaManager.onStartLoadPanoramaImage=this.thumbnailManager.selectThumbnail},this.loadStereoHouseManager=function(t){this.stereoHouseManager=new u,this.addObject(this.stereoHouseManager),this.stereoHouseManager.init(t)},this.loadFloorPlanManager=function(t){var e=this.getDefaultHotSpot(t);this.floorPlanManager=new h,this.addObject(this.floorPlanManager),this.floorPlanManager.init(t,e)},this.loadVrManager=function(){this.vrManager=new VRManager,this.addObject(this.vrManager),this.vrManager.init(this.panoramaManager.camera),this.vrManager.object3D.visible=!1,this.vrManager.onVRModeEnabled=function(e){r.zoomInButton.style.visibility=e?"hidden":"visible",r.zoomOutButton.style.visibility=e?"hidden":"visible",t.panoramaManager.setTargetZoomFov(e?VRParams.fov:t.vrManager.previousFov)}},this.loadAppResources=function(t,e){var o;if(a.isDisplayPanoramaFirst||a.isSingleMode){var i=this.getDefaultHotSpot(t);o=s.getPrepareResourceUrls(i)}else o=u.getPrepareResourceUrls(t);l.prepareResources(o,e,function(t){r.loadingProgressBar.style.width=t+"%"},function(){r.loading.style.visibility="hidden",$(r.loadingTip).text("加载失败")})},this.onAppResourcesLoaded=function(t){r.welcome.style.visibility="hidden";var e=this.getDefaultHotSpot(t);if(a.isSingleMode)return this.loadPanoramaManager(t),this.panoramaManager.loadPanoramaImage(e,!0,c.isAutoRotateWhenStart),this.loadThumbnailManager(t),this.thumbnailManager.loadThumbnail(),void this.thumbnailManager.selectThumbnail(e.ID);a.isDisplayPanoramaFirst?(this.loadPanoramaManager(t),this.panoramaManager.loadPanoramaImage(e,!0,c.isAutoRotateWhenStart),this.loadFloorPlanManager(t),this.floorPlanManager.object3D.visible=!1,this.loadStereoHouseManager(t),this.stereoHouseManager.switchToSmallView(),this.loadThumbnailManager(t),this.thumbnailManager.loadThumbnail(),this.thumbnailManager.selectThumbnail(e.ID),this.bindControlEvents()):(this.loadPanoramaManager(t),this.panoramaManager.object3D.visible=!1,this.loadStereoHouseManager(t),this.loadFloorPlanManager(t),this.floorPlanManager.object3D.visible=!1,this.loadThumbnailManager(t),a.alwaysDisplayThumbnail&&(this.thumbnailManager.loadThumbnail(),this.thumbnailManager.selectThumbnail(e.ID)),this.bindControlEvents(),this.stereoHouseManager.switchToLargeView()),a.isPhone&&this.loadVrManager()}};d.prototype=new i.App,d.prototype.init=function(t,e){var o=this;this.houseData=e;var s=new THREE.WebGLRenderer;s.antialias=!0,s.sortObjects=!1,s.setPixelRatio(a.isPhone?4:2),s.gammaInput=!0,s.gammaOutput=!0,s.autoClearColor=!1,s.setSize(i.screenWidth,i.screenHeight);var l={renderer:s,container:t,scene:new THREE.Scene};i.App.prototype.init.call(this,l),n.listen(s.domElement,t),this.floorPlanSwitchBtnGroup=[r.switch3DButton,r.switch2DButton,r.switchAutoButton],this.largeViewSwitchBtnGroup=[r.largeViewSwitch2DButton,r.largeViewSwitch3DButton],this.loadAppResources(e,function(){o.onAppResourcesLoaded(e)})},d.prototype.onWindowResize=function(){this.renderer.setSize(i.screenWidth,i.screenHeight),this.thumbnailManager&&this.thumbnailManager.onWindowResize()},t.exports=d},function(t,e){var o=function(t,e){function o(e,o){d=!0,p=e,g=o,b=t.rotation.y,w=t.rotation.x,E.isAutoPlay=!1}function i(e,o){d&&E.enabled&&(f=(e-p)*E.speed*.002+b,v=(o-g)*E.speed*.002+w,v=Math.max(E.minPolarAngle,Math.min(E.maxPolarAngle,v)),t.rotation.x=v,t.rotation.y=f,E.onCameraRotate())}function a(){d=!1}function n(t){t.preventDefault(),t.stopPropagation(),o(t.touches[0].pageX*E.speed*S,t.touches[0].pageY*E.speed*S)}function r(t){t.preventDefault(),t.stopPropagation(),i(t.touches[0].pageX*E.speed*S,t.touches[0].pageY*E.speed*S)}function s(t){t.preventDefault(),t.stopPropagation(),a()}function l(t){t.preventDefault(),o(t.clientX,t.clientY),document.addEventListener("mousemove",c,!1),document.addEventListener("mouseup",h,!1)}function c(t){t.preventDefault(),i(t.clientX,t.clientY)}function h(t){t.preventDefault(),a(),document.removeEventListener("mousemove",c,!1),document.removeEventListener("mouseup",h,!1)}function u(){E.enabled&&E.isAutoPlay&&!d&&(t.rotation.y-=.001*E.autoRotateSpeed)}function m(){requestAnimationFrame(m),u()}this.enabled=!0,this.isAutoPlay=!1,this.autoRotateSpeed=1,this.speed=1,this.minPolarAngle=THREE.Math.degToRad(-85),this.maxPolarAngle=THREE.Math.degToRad(85),this.onCameraRotate=function(){};var d=!1,p=0,g=0,f=0,b=0,v=0,w=0,S=3,E=this;!function(t){null!==t&&void 0!==t||(t=document),t.addEventListener("mousedown",l,!1),t.addEventListener("mousemove",c,!1),t.addEventListener("mouseup",h,!1),t.addEventListener("touchstart",n,!1),t.addEventListener("touchend",s,!1),t.addEventListener("touchmove",r,!1)}(e),m()};t.exports=o},function(t,e,o){var i=o(1),a=function t(){i.Object.call(this);var e=new THREE.Object3D;this.setObject3D(e),this.createCrosshairRing=function(){var t=new THREE.Mesh(new THREE.RingGeometry(.02,.04,32),new THREE.MeshBasicMaterial({color:16777215,opacity:.5,transparent:!0}));return t.visible=!1,t.position.z=-2,t},this.showVRStartTip=function(t){var e=$(DomElements.vrStartTip);t?(DomElements.vrStartTip.style.visibility="visible",e.stop(),clearTimeout(DomElements.vrStartTip.timeout),e.fadeIn(500,function(){DomElements.vrStartTip.timeout=setTimeout(function(){e.fadeOut(1500)},2e3)})):(e.stop(),e.hide())},this.enable=function(t){this.object3D.visible=t,this.vrControls.resetSensor(),this.vrControls.enabled=t,this.vrControls.manualRotation=this.camera.rotation.clone(),t||this.enableVRMode(!1),this.isLandscape=Util.isLandscape(),this.showVRStartTip(t&&!this.isLandscape)},this.enableVRMode=function(e){EventListener.vrEnabled=e,this.crossHairRing.visible=e,this.isInVRMode=e,this.showVRStartTip(!e),e?(this.previousFov=this.camera.fov,this.camera.fov=VRParams.fov):this.previousFov&&(this.camera.fov=this.previousFov),this.camera.updateProjectionMatrix(),this.onVRModeEnabled(e),t.isInVRMode=e},this.onVRModeEnabled=function(t){}};a.isInVRMode=!1,a.prototype=new i.Object,a.prototype.init=function(t){this.scene=this.getScene(),this.renderer=this.getRenderer(),this.camera=t,this.vrControls=new THREE.VRControls(this.camera,this.renderer.domElement),this.vrEffect=new THREE.StereoEffect(this.renderer),this.vrEffect.setSize(i.screenWidth,i.screenHeight),this.isLandscape=Util.isLandscape(),this.isInVRMode=!1,this.crossHairRing=this.createCrosshairRing(),this.previousFov=null,this.camera.add(this.crossHairRing),this.setLayer(Layer.PanoramaManager)},a.prototype.update=function(){this.isLandscape?(this.vrEffect.render(this.scene,this.camera),this.isInVRMode||this.enableVRMode(!0)):this.isInVRMode&&this.enableVRMode(!1)},a.prototype.onWindowResize=function(){this.isLandscape=Util.isLandscape()},t.exports=a},function(t,e,o){var i=o(1),a=o(0),n=o(10),r=o(4),s=o(2),l=o(6),c=o(7),h=o(5),u=o(3),m=function(){i.Object.call(this);var t=new THREE.Object3D;t.name="FloorPlanManager",this.setObject3D(t);var e=this;this.createHighlightHotSpotSprite=function(){var t=s.loadTexture("src/images/hotSpotPoint_HighLight_small.png"),e=new THREE.SpriteMaterial({map:t}),o=new THREE.Sprite(e);return o.scale.set(60,60,1),o.position=3,o},this.createSectorSprite=function(){var t=s.loadTexture("src/images/sector.png"),e=new THREE.SpriteMaterial({map:t}),o=new THREE.Sprite(e);return o.scale.set(300,300,1),o.material.opacity=.3,this.sectorSprite=o,o},this.createHighlightHotSpotGroup=function(){var t=new THREE.Group;return t.add(this.createHighlightHotSpotSprite()),t.add(this.createSectorSprite()),this.highlightHotSpotGroup=t,t},this.createHotSpotSprite=function(t){var e=new THREE.Sprite(t);return e.scale.set(n.hotSpotSize,n.hotSpotSize,1),e.name="HotSpotSprite",e},this.createHotSpotNameSprite=function(t){var e=l.createTextSprite(t,{fontsize:50,backgroundColor:{r:0,g:0,b:0,a:.5},cornerAngle:50,borderColor:{r:0,g:0,b:0,a:0}});return e.position.set(0,n.hotSpotNameMarginTop,0),e.scale.copy(e.defaultScale.multiplyScalar(10)),e.name=t,this.hotSpotNameSprites.push(e),e},this.createHotSpotGroup=function(t,e){var o=new THREE.Group;return o.position.set(t.Position.x,t.Position.z,1),o.add(this.createHotSpotNameSprite(t.Name)),o.add(this.createHotSpotSprite(e)),o.hotSpotData=t,o.name=t.Name,this.hotSpotGroups.push(o),o},this.createHotSpotsGroup=function(t){var e=new THREE.Group,o=s.loadTexture("src/images/hotSpotPoint_small.png"),i=new THREE.SpriteMaterial({map:o});e.add(this.createHighlightHotSpotGroup());for(var a in t)e.add(this.createHotSpotGroup(t[a],i));return e},this.createFloorPlanSprite=function(t){var o=new THREE.SpriteMaterial,i=new THREE.Sprite(o),r=a.housePathPrefix+t.FloorPlanPath;return i.material.map=s.loadTexture(r,function(t){var o=t.image.width,a=t.image.height;i.scale.set(o,a,1),e.smallViewSize=Math.max(o,a)*n.smallViewMargin,e.onWindowResize()}),i},this.createFloorPlanGroup=function(t){var e=new THREE.Group,o=this.createHotSpotsGroup(this.getHotSpotsDataOfFloor(t));return t.IsMatchCustomFloorPlan&&(o.position.x=t.FloorPlanCenterPoint.x,o.position.y=t.FloorPlanCenterPoint.y),e.add(o),e.add(this.createFloorPlanSprite(t)),e},this.createBackgroundSprite=function(){var t=new THREE.SpriteMaterial({transparent:!0,color:n.bgColor,opacity:n.bgOpacity}),e=Math.max(1e5,1e5),o=new THREE.Sprite(t);return o.name="FloorPlanBg",o.scale.set(e,e,1),o.position.z=-1,o},this.createCamera=function(){var t=new THREE.OrthographicCamera(1,1,1,1,1,20);return t.position.z=10,t},this.setVisibleOfHotSpotNameSprites=function(t){for(var e in this.hotSpotNameSprites)this.hotSpotNameSprites[e].visible=t},this.setHighlightHotSpotPosition=function(t){var o=e.getFloorByHotSpotId(t.ID);e.switchFloorPlan(o),e.setVisibleOfHotSpotNameSprites(!1);for(var i in e.hotSpotGroups){var a=e.hotSpotGroups[i].hotSpotData.ID===t.ID;e.hotSpotGroups[i].getObjectByName("HotSpotSprite").visible=!a}e.highlightHotSpotGroup.position.set(t.Position.x,t.Position.z,1)},this.onPanoramaCameraRotationUpdate=function(t){e.sectorSprite.material.rotation=t+.7},this.registEventListener=function(){for(var t=0;t<this.hotSpotGroups.length;t++)h.get(this.hotSpotGroups[t]).onclick=this.onHotSpotClicked;h.get(this.backgroundSprite).onclick=this.switchToLargeView},this.enableHotSpotsEvent=function(t){for(var e=0;e<this.hotSpotGroups.length;e++)h.get(this.hotSpotGroups[e]).enabled=t},this.onHotSpotClicked=function(t){e.onHotSpotClick(t.hotSpotData),e.switchToSmallView()},this.switchToLargeView=function(){e.switchView(!1),e.onSwitchToLargeView()},this.switchToSmallView=function(){e.switchView(!0),e.onSwitchToSmallView()},this.switchView=function(t){this.isSmallView=t,this.backgroundSprite.visible=t,this.setVisibleOfHotSpotNameSprites(!t),this.enableHotSpotsEvent(!t),this.onWindowResize(),u.thumbnailController.style.visibility=t||a.alwaysDisplayThumbnail?"visible":"hidden",u.controlDiv.style.visibility=t?"visible":"hidden",u.enterPanoramaViewBtn.style.visibility=t?"hidden":"visible"},this.getHotSpotById=function(t){var e=this.houseData.HotSpots;for(var o in e)if(e[o].ID===t)return e[o]},this.getHotSpotsDataOfFloor=function(t){var e=[];for(var o in t.Rooms){var i=t.Rooms[o];for(var a in i.HotSpotIds){var n=this.getHotSpotById(i.HotSpotIds[a]);e.push(n)}}return e},this.getFloorByHotSpotId=function(t){for(var e in this.houseData.Floors){var o=this.houseData.Floors[e];for(var i in o.Rooms){var a=o.Rooms[i];if(r.contains(a.HotSpotIds,t))return o}}},this.switchFloorPlan=function(t){t&&this.currentFloor!==t&&(this.floorPlanGroup&&this.object3D.remove(this.floorPlanGroup),this.hotSpotGroups=[],this.floorPlanGroup=this.createFloorPlanGroup(t),this.object3D.add(this.floorPlanGroup),this.setLayer(c.FloorPlanManager),this.currentFloor=t,this.registEventListener())},this.onSwitchToLargeView=function(){},this.onSwitchToSmallView=function(){},this.onHotSpotClick=function(){}};m.prototype=new i.Object,m.prototype.init=function(t,e){this.scene=this.getScene(),this.renderer=this.getRenderer(),this.camera=this.createCamera(),this.houseData=t,this.largeViewBackground=new THREE.Color(a.largeViewBgColor),this.sectorSprite=null,this.hotSpotGroups=[],this.isSmallView=!0,this.backgroundSprite=this.createBackgroundSprite(),this.hotSpotNameSprites=[],this.smallViewSize=1,this.highlightHotSpotGroup=null,this.currentFloor=null,this.object3D.add(this.camera),this.object3D.add(this.backgroundSprite);var o=this.getFloorByHotSpotId(e.ID);this.switchFloorPlan(o),this.setHighlightHotSpotPosition(e),this.setLayer(c.FloorPlanManager),this.switchToSmallView()},m.prototype.update=function(){this.isSmallView||(this.renderer.setClearColor(this.largeViewBackground),this.renderer.clearColor()),this.renderer.setViewport(this.camera.viewPort.left,this.camera.viewPort.top,this.camera.viewPort.width,this.camera.viewPort.height),this.renderer.render(this.scene,this.camera)},m.prototype.onWindowResize=function(){if(this.isSmallView)this.camera.left=-this.smallViewSize/2,this.camera.right=this.smallViewSize/2,this.camera.top=this.smallViewSize/2,this.camera.bottom=-this.smallViewSize/2;else{var t=i.screenWidth/i.screenHeight,e=t<1?this.smallViewSize:this.smallViewSize*t,o=t<1?this.smallViewSize/t:this.smallViewSize;this.camera.left=-e/2,this.camera.right=e/2,this.camera.top=o/2,this.camera.bottom=-o/2}var r=Math.min(i.screenWidth,i.screenHeight);a.isPhone&&(r=Math.min(screen.width,screen.height));var s,l,c,h;if(this.isSmallView){if(s=Math.floor(r*n.leftBaseSize/n.refBaseSize),l=Math.floor(r*n.topBaseSize/n.refBaseSize),c=h=Math.floor(r*n.size.baseSize/n.refBaseSize)+n.size.extraPixels,a.isPhone){var m=parseInt((c-2)/3);u.switch2DButton.style.width=m+"px",u.switch3DButton.style.width=m+"px",u.switchAutoButton.style.width=c-2-2*m+"px",u.controllerLeft.style.top=c+1+"px"}}else s=0,l=0,c=i.screenWidth,h=i.screenHeight;this.camera.viewPort={left:s,top:l,width:c,height:h},this.camera.updateProjectionMatrix()},t.exports=m},function(t,e,o){var i=o(1),a=o(0),n=o(9),r=o(5),s=o(2),l=o(6),c=o(10),h=o(7),u=o(3),m={largeFov:60,smallFov:35,orbitControlsMaxDistance:1.4,orbitControlsMinDistance:.7,smallViewAutoRotateSpeed:.7,isLargeViewAutoRotate:!0,beamHeight:70,beamRadius:12,hotSpotNameHeight:40},d=function(){i.Object.call(this);var t=this,e=new THREE.Object3D;this.setObject3D(e),this.createCylinderHotSpotGroup=function(t,e,o){var i=new THREE.Group;return i.name=t.Name,i.hotSpotData=t,i.position.set(t.Position.x,t.Position.y+4.5,-t.Position.z),i.add(this.createBeamObject3D(e)),i.add(this.createFeetObject3D(o)),a.displayRoomName&&i.add(this.createNameObject3D(t.Name)),this.hotSpotGroups.push(i),i},this.prepareBeamResources=function(){var t=s.loadTexture("src/images/hotspot/light.png");t.minFilter=THREE.NearestFilter;var e=new THREE.CylinderGeometry(m.beamRadius,m.beamRadius,m.beamHeight,20,1,!0);return{material:new THREE.MeshBasicMaterial({map:t,transparent:!0,depthWrite:!1,side:THREE.DoubleSide}),geometry:e}},this.createBeamObject3D=function(t){var e=new THREE.Mesh(t.geometry,t.material);return e.position.set(0,m.beamHeight/2,0),e},this.prepareFeetResources=function(){var t=s.loadTexture("src/images/hotspot/feet.png");return t.minFilter=THREE.NearestFilter,{material:new THREE.MeshBasicMaterial({map:t,transparent:!0}),geometry:new THREE.PlaneBufferGeometry(12,12,1,1)}},this.createFeetObject3D=function(t){var e=new THREE.Mesh(t.geometry,t.material);return e.rotation.x=THREE.Math.degToRad(270),e},this.createNameObject3D=function(t){var e=l.createTextSprite(t,{fontsize:250,backgroundColor:{r:0,g:0,b:0,a:.498039},cornerAngle:40});return e.position.set(0,m.beamHeight/2+m.hotSpotNameHeight,0),e},this.createLineObject3D=function(){var t=new THREE.LineBasicMaterial({color:32768,linewidth:1}),e=new THREE.Geometry;return e.vertices.push(new THREE.Vector3,new THREE.Vector3(0,m.beamHeight,0)),new THREE.Line(e,t)},this.createCylinderHotSpotsGroup=function(t,e){var o=new THREE.Group,i=this.prepareBeamResources(),a=this.prepareFeetResources();for(var n in e)o.add(this.createCylinderHotSpotGroup(e[n],i,a));return o.position.y=-t,o},this.registEventListener=function(){for(var e=0;e<this.hotSpotGroups.length;e++)r.get(this.hotSpotGroups[e]).onclick=function(e){t.onHotSpotClicked(e.hotSpotData)}},this.onHotSpotClicked=function(t){}};d.prototype=new i.Object,d.prototype.init=function(t,e){this.hotSpotGroups=[],this.object3D.add(this.createCylinderHotSpotsGroup(t,e)),this.registEventListener()};var p=function(){function t(t){var e=new THREE.PlaneBufferGeometry(t.Width,t.Height,1,1),i=new THREE.MeshBasicMaterial({map:null,side:THREE.BackSide,alphaTest:.1});i.transparent=!0,i.depthWrite=!0;var n=new THREE.Mesh(e,i);n.rotation.reorder("YXZ"),n.rotation.set(THREE.Math.degToRad(t.Rotation.x),THREE.Math.degToRad(t.Rotation.y),THREE.Math.degToRad(t.Rotation.z)),n.position.set(t.Position.x,t.Position.y,-t.Position.z),n.visible=!1;var r=a.housePathPrefix+t.ImagePath;return s.loadTextureInQueue(r,function(t){t.minFilter=THREE.LinearFilter,i.map=t,i.needsUpdate=!0,n.visible=!0}),o.roomFaces.push(n),n}i.Object.call(this);var e=new THREE.Object3D;this.setObject3D(e);var o=this;this.createRoomFaces=function(e){for(var o in e.RoomFaces)this.object3D.add(t(e.RoomFaces[o]))},this.onRoomFaceClicked=function(){o.onRoomClicked(o.roomData)},this.registEventListener=function(){for(var t in this.roomFaces)r.get(this.roomFaces[t]).onclick=this.onRoomFaceClicked},this.enableRoomFaceEvents=function(t){for(var e in this.roomFaces)r.get(this.roomFaces[e]).enabled=t},this.onRoomClicked=function(){}};p.prototype=new i.Object,p.prototype.init=function(t){this.object3D.name=t.Name,this.object3D.position.set(t.Position.x,t.Position.y,-t.Position.z),this.object3D.rotation.set(0,THREE.Math.degToRad(-t.Rotation),0),this.roomFaces=[],this.roomData=t,this.createRoomFaces(t),this.registEventListener()};var g=function(){function t(){s.isSmallView||(s.orbitControls.autoRotate=!1,m.isLargeViewAutoRotate&&e())}function e(){clearTimeout(s.largeViewAutoRotateTimeout),s.largeViewAutoRotateTimeout=setTimeout(function(){!s.isSmallView&&s.object3D.visible&&(s.orbitControls.autoRotate=!0)},a.switchAutoTimeout)}function o(){if(!s.isControlTipShowed){var t=$(u.controlTip);a.isPhone||t.children(":last").hide();var e=(window.innerWidth-t.outerWidth())/2,o=(window.innerHeight-t.outerHeight())/2;t.css("transform","translate("+e+"px, "+o+"px)"),t.fadeIn(1500,function(){setTimeout(function(){t.fadeOut(1500)},2e3)}),s.isControlTipShowed=!0}}i.Object.call(this);var n=new THREE.Object3D;this.setObject3D(n);var s=this;this.getDefaultCameraPosition=function(t){var e=THREE.Math.degToRad(120),o=THREE.Math.degToRad(60),i=Math.max(t.x,t.y,t.z);return(new THREE.Vector3).setFromSpherical(new THREE.Spherical(i,o,e))},this.setLargeViewCameraBestPosition=function(){var t=(new THREE.Spherical).setFromVector3(s.camera.position),e=s.camera.aspect<1?s.maxHouseSize/s.camera.aspect:s.maxHouseSize;t.radius=e+100,s.camera.position.setFromSpherical(t),s.orbitControls.maxDistance=t.radius*m.orbitControlsMaxDistance},this.addOrbitControlsToCamera=function(t,e){var o=new THREE.OrbitControls(t,this.renderer.domElement);o.maxPolarAngle=THREE.Math.degToRad(90),o.minPolarAngle=THREE.Math.degToRad(10),o.autoRotate=m.isLargeViewAutoRotate,o.autoRotateSpeed=1,o.zoomSpeed=1,o.enableDamping=!0,o.dampingFactor=.8,o.enablePan=!1;var i=Math.max(e.x,e.y,e.z),a=(e.x+e.z)/2;return o.minDistance=a*m.orbitControlsMinDistance,o.maxDistance=i*m.orbitControlsMaxDistance,o},this.createCamera=function(t){var e=new THREE.PerspectiveCamera(m.largeFov,1,.5,1e5);return e.name="HouseManager",e.rotation.reorder("YXZ"),e.position.copy(this.getDefaultCameraPosition(t)),e},this.createBackgroundCube=function(t){for(var e=[],o=0;o<6;o++)e.push(new THREE.MeshBasicMaterial({side:THREE.BackSide,transparent:!0,color:c.bgColor,opacity:c.bgOpacity}));var i=2*Math.max(t.x,t.y,t.z),a=new THREE.Mesh(new THREE.CubeGeometry(i,i,i),e);return this.backgroundCube=a,a},this.switchToSmallViewWithAnimation=function(t){var e=s.camera.position.clone(),o=s.camera.rotation.clone(),i=(new THREE.Vector3).copy(t.Position);i.z=-i.z;var a=o.clone();a.x=0,s.cameraFlyAnimation.play(s.camera,e,o,i,a,function(){s.switchView(!0)},function(){s.hotSpotManager.setVisible(!1)})},this.switchToSmallView=function(){s.switchView(!0),s.onSwitchToSmallView()},this.switchToLargeView=function(){s.switchView(!1),o(),s.setLargeViewCameraBestPosition(),s.onSwitchToLargeView()},this.switchView=function(t){this.isSmallView=t,this.hotSpotManager.setVisible(!t),this.orbitControls.enabled=!t,this.orbitControls.autoRotate=!t&&m.isLargeViewAutoRotate,this.backgroundCube.visible=t,this.camera.fov=t?m.smallFov:m.largeFov,this.onWindowResize(),u.enterHotSpotTip.style.visibility=t?"hidden":"visible",u.thumbnailController.style.visibility=t||a.alwaysDisplayThumbnail?"visible":"hidden",u.controlDiv.style.visibility=t?"visible":"hidden",u.enterPanoramaViewBtn.style.visibility=t?"hidden":"visible",this.enableRoomEvents(!t)},this.onPanoramaCameraRotationUpdate=function(t,e){if(s.isSmallView){var o=s.isSmallViewAutoRotate&&!e?s.camera.lastTheta-.002*m.smallViewAutoRotateSpeed:t,i=(new THREE.Vector3).setFromSpherical(new THREE.Spherical(s.smallViewControlRadius,1,o));s.camera.position.copy(i),s.camera.lookAt(new THREE.Vector3(0,0,0)),s.camera.lastTheta=o}},this.enableSmallViewAutoRotate=function(t){this.isSmallViewAutoRotate=t},this.getHotSpotById=function(t){var e=this.houseData.HotSpots;for(var o in e)if(e[o].ID===t)return e[o]},this.onRoomClicked=function(t){if(t.HotSpotIds&&t.HotSpotIds.length>0){var e=s.getHotSpotById(t.HotSpotIds[0]);e&&s.onHotSpotClicked(e)}},this.registEventListener=function(){r.get(this.backgroundCube).onclick=this.switchToLargeView,document.attachEvent?(s.renderer.domElement.attachEvent("touchend",t,!1),s.renderer.domElement.attachEvent("mouseup",t,!1)):(s.renderer.domElement.addEventListener("touchend",t,!1),s.renderer.domElement.addEventListener("mouseup",t,!1))},this.enableRoomEvents=function(t){for(var e in this.roomObj3Ds)this.roomObj3Ds[e].enableRoomFaceEvents(t)},this.onSwitchToLargeView=function(){},this.onSwitchToSmallView=function(){},this.onHotSpotClicked=function(){}};g.getPrepareResourceUrls=function(t){var e=[];for(var o in t.Floors){var i=t.Floors[o];for(var n in i.Rooms){var r=i.Rooms[n];for(var s in r.RoomFaces){var l=r.RoomFaces[s],c=a.housePathPrefix+l.ImagePath;e.push(c)}}}return e},g.prototype=new i.Object,g.prototype.init=function(t){this.object3D.name=t.Name,this.scene=this.getScene(),this.renderer=this.getRenderer(),this.largeViewBackground=new THREE.Color(a.largeViewBgColor),this.camera=this.createCamera(t.HouseSize),this.orbitControls=this.addOrbitControlsToCamera(this.camera,t.HouseSize),this.isSmallView=!1,this.backgroundCube=null,this.isSmallViewAutoRotate=!1,this.largeViewAutoRotateTimeout=null,this.isControlTipShowed=!1,this.maxHouseSize=Math.max(t.HouseSize.x,t.HouseSize.y,t.HouseSize.z),this.smallViewControlRadius=2*this.maxHouseSize,this.houseData=t,this.roomObj3Ds=[],this.cameraFlyAnimation=new f,this.object3D.add(this.camera);for(var e in t.Floors){var o=t.Floors[e];for(var i in o.Rooms){var n=new p;this.addChild(n),n.init(o.Rooms[i]),n.onRoomClicked=this.onRoomClicked,this.roomObj3Ds.push(n)}}this.hotSpotManager=new d,this.addChild(this.hotSpotManager),this.hotSpotManager.init(t.CameraHeight,t.HotSpots),this.object3D.add(this.createBackgroundCube(t.HouseSize)),this.setLayer(h.StereoHouse),this.registEventListener()},g.prototype.update=function(){this.isSmallView||(this.renderer.setClearColor(this.largeViewBackground),this.renderer.clearColor()),this.renderer.setViewport(this.camera.viewPort.left,this.camera.viewPort.top,this.camera.viewPort.width,this.camera.viewPort.height),this.renderer.render(this.scene,this.camera),this.orbitControls.update()},g.prototype.onWindowResize=function(){var t=Math.min(i.screenWidth,i.screenHeight);a.isPhone&&(t=Math.min(screen.width,screen.height));var e,o,n,r;this.isSmallView?(e=Math.floor(t*c.leftBaseSize/c.refBaseSize),o=Math.floor(t*c.topBaseSize/c.refBaseSize),n=r=Math.floor(t*c.size.baseSize/c.refBaseSize)+c.size.extraPixels,this.camera.aspect=1):(e=0,o=0,n=i.screenWidth,r=i.screenHeight,this.camera.aspect=n/r),this.camera.viewPort={left:e,top:o,width:n,height:r},this.camera.updateProjectionMatrix()};var f=function(){var t={duration:600,positionPower:1/3,rotationPower:3,closeToHotSpotThreshold:75};n.call(this,t,t.duration)};f.prototype=new n,f.prototype.play=function(t,e,o,i,a,r,s){var l={camera:t,startPosition:e,startRotation:o,endPosition:i,endRotation:a,onFinished:r,onCloseToTarget:s};this.params=Object.assign(this.params,l),n.prototype.play.call(this)},f.prototype.update=function(t,e){var o=t.startPosition.clone(),i=t.startRotation.toVector3();o=o.lerp(t.endPosition,Math.pow(e,t.positionPower)),i=i.lerp(t.endRotation,Math.pow(e,t.rotationPower)),t.camera.position.copy(o),t.camera.rotation.setFromVector3(i),o.distanceTo(t.endPosition)<t.closeToHotSpotThreshold&&t.onCloseToTarget&&t.onCloseToTarget()},f.prototype.onFinished=function(t){t.onFinished&&t.onFinished()},t.exports=g},function(t,e){var o=function t(){function e(t){return a.appendChild(t.dom),t}function o(t){for(var e=0;e<a.children.length;e++)a.children[e].style.display=e===t?"block":"none";i=t}var i=0,a=document.createElement("div");a.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",a.add("click",function(t){t.preventDefault(),o(++i%a.children.length)},!1);var n=(performance||Date).now(),r=n,s=0,l=e(new t.Panel("FPS","#0ff","#002")),c=e(new t.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var h=e(new t.Panel("MB","#f08","#201"));return o(0),{REVISION:16,dom:a,addPanel:e,showPanel:o,begin:function(){n=(performance||Date).now()},end:function(){s++;var t=(performance||Date).now();if(c.update(t-n,200),t>r+1e3&&(l.update(1e3*s/(t-r),100),r=t,s=0,h)){var e=performance.memory;h.update(e.usedJSHeapSize/1048576,e.jsHeapSizeLimit/1048576)}return t},update:function(){n=this.end()},domElement:a,setMode:o}};o.Panel=function(t,e,o){var i=1/0,a=0,n=Math.round,r=n(window.devicePixelRatio||1),s=80*r,l=48*r,c=3*r,h=2*r,u=3*r,m=15*r,d=74*r,p=30*r,g=document.createElement("canvas");g.width=s,g.height=l,g.style.cssText="width:80px;height:48px";var f=g.getContext("2d");return f.font="bold "+9*r+"px Helvetica,Arial,sans-serif",f.textBaseline="top",f.fillStyle=o,f.fillRect(0,0,s,l),f.fillStyle=e,f.fillText(t,c,h),f.fillRect(u,m,d,p),f.fillStyle=o,f.globalAlpha=.9,f.fillRect(u,m,d,p),{dom:g,update:function(l,b){i=Math.min(i,l),a=Math.max(a,l),f.fillStyle=o,f.globalAlpha=1,f.fillRect(0,0,s,m),f.fillStyle=e,f.fillText(n(l)+" "+t+" ("+n(i)+"-"+n(a)+")",c,h),f.drawImage(g,u+r,m,d-r,p,u,m,d-r,p),f.fillRect(u+d-r,m,r,p),f.fillStyle=o,f.globalAlpha=.9,f.fillRect(u+d-r,m,r,n((1-l/b)*p))}}},t.exports=o},function(t,e){var o=function(){};o.debugTextValue="",o.debugText=document.getElementById("debugText"),o.log=function(t){console.log(t),o.enabled&&(o.debugTextValue+=t,o.debugTextValue+="\n",o.debugText.value=o.debugTextValue)},o.enableStats=!1,o.enabled=!1,o.enabled&&(o.debugText.style.visibility="visible"),o.enableStats&&Util.addStats(DomElements.vrHouseContainer),t.exports=o}])});
//# sourceMappingURL=pano.min.js.map